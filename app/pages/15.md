title: 使用Amazon Echo语音控制2048 
date:
tags:

sidebar:


前一阵子去hackathon和队友体验了一把Amazon Echo,这个小玩意简直完爆Siri几条街，扩展能力特别强。这次我们使用python的Flask来通过Echo操作2048，完成各个方向的滑动。什么？你说Flask咋还能干这个。哈哈python还能上天呢




##工具准备



- Flask 
- Flask-Ask
- EchoSim
- ngrok
- Python3
- [Python 2048]()



##修改2048的输入

要使用Echo作为输入源，原理非常简单粗暴。只要把程序中的键盘输入源去掉->换成Echo输入源。具体来讲就是

- 使用'left','right'字符串来代替键盘按键
- 使用Echo生成'left,'right'字符串

让我们先来看看2048程序里面的两个文件，其中puzzle部分包含了键盘输入部分，分为下面几个部分

第一部分定义了2048以接受'wasd'字符的方式来操作

    	KEY_UP = "'w'"
	KEY_DOWN = "'s'"
	KEY_LEFT = "'a'"
	KEY_RIGHT = "'d'"

因为我们会对Echo说出具体方向，所以我们把它改成

	KEY_UP = "up"
	KEY_DOWN = "down"
	KEY_LEFT = "left"
	KEY_RIGHT = "right"

现在我们要取消wasd与键盘上的wasd按键绑定，先删掉GameGrid类中__init__方法里面的

	self.master.bind("<Key>", self.key_down)

接着将key_down方法中的

	key = repr(event.char)

改成

	key = event

由于程序使用了tkinter的GUI，内部又一个封闭的循环我们不能通过python的交互指令来操作2048,所以我们需要先禁用这个初始化以及自动循环的过程，后面我们手动初始化，来到GameGrid类中的__init__方法，删除下面几行

        self.init_grid()#初始化游戏界面
        self.init_matrix()#初始化头两个数字
        self.update_grid_cells()#展现在面板上
        
        self.mainloop()#循环


这个时候我们已经拜托了原来的操作方式，来python的交互界面试一下

	>>> from puzzle import *
	>>> gamegrid = Gamegrid()
	#手动初始化
	>>> gamegrid.init_grid()
	>>> gamegrid.init_matrix()
	>>> gamegrid.update_grid_cells()
	#操作
	>>> gamegrid.key_down('up')
	>>> gamegrid.key_down('down')

这个时候我们对puzzle.py的改造已经完成，我们需要一种类似input的方法来进行移动，接下来我们来使用Flask搭建和Echo沟通的桥梁

##


###引入工具

	from flask import Flask
	from flask_ask import Ask,statement,question,session
	from puzzle import *
	from threading import Thread


###初始化工具

	app = Flask(__name__)
	ask = Ask(app,"/")
	direc = ''
	gamegrid =GameGrid()	

###启动

	@ask.intent('YesIntent')
	def next_round():
		ins_msg = "Please say the direction to move"
		return question(ins_msg)


###操作

	



##多线程和监听

###多线程

	f = Thread(target = app.run)
	f.start()
	listener()
	f.join()

###监听

	def listener():
		global direc
		global gamegrid
		tmp = direc
		while True:
			try:

				if direc != tmp:
					
					gamegrid.key_down(direc)
					tmp = direc
				if direc == 'stop':
					break
			
			except:
				pass




###

















